FROM monroe/base

MAINTAINER tomasz.rozensztrauch@radytek.com

# Build and install NEAT library

RUN apt-get update && \
    apt-get install -y git build-essential cmake \
        libuv1-dev libldns-dev libjansson-dev libmnl-dev libsctp-dev && \
    mkdir -p /opt/celerway && \
    cd /opt/celerway && \
    git clone https://github.com/NEAT-project/neat.git && \
    cd neat/ && \
    mkdir build && \
    cd build/ && \
#    git checkout 5bb5a059f67b29749004c50b4c6b6e88dd551a34 && \
    cmake .. && \
    make && \ 
    make install && \
    cd ../ && \
    rm -Rf build && \
    apt-get purge -y git build-essential cmake \
        libuv1-dev libldns-dev libmnl-dev libjansson-dev libsctp-dev && \
    apt-get autoremove -y && \
    apt-get install -y libuv1 libldns2 libmnl0 libjansson4 libsctp1 && \
    apt-get clean

# Copy files and create experiment entry point

COPY files/* /opt/celerway/
WORKDIR /opt/celerway
RUN dpkg -i neat-http-get_1.0.0_amd64.deb

ENTRYPOINT ["dumb-init", "--", "/bin/bash", "/opt/celerway/neat_experiment.sh"]

